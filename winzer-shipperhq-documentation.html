<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winzer ShipperHQ Shipping Rules Documentation</title>
    <link rel="stylesheet" href="arcadia-style.css">
</head>
<body>
    <div class="container">
        <h1>ShipperHQ Shipping Rules Documentation</h1>
        
        <h2 id="table-of-contents">Table of Contents</h2>
        <ol>
            <li><a href="#shipping-rules-overview">Shipping Rules Overview</a></li>
            <li><a href="#shipping-groups-metafield">Shipping Groups Metafield</a></li>
            <li><a href="#shipping-group-values">Shipping Group Values</a></li>
            <li><a href="#shipping-rules-logic">Shipping Rules Logic</a></li>
            <li><a href="#shipperhq-integration">ShipperHQ Integration</a></li>
            <li><a href="#customer-experience">Customer Experience</a></li>
            <li><a href="#data-flow">Data Flow & Processing</a></li>
            <li><a href="#maintenance-troubleshooting">Maintenance & Troubleshooting</a></li>
        </ol>
        <hr />

        <h2 id="shipping-rules-overview">Shipping Rules Overview</h2>
        
        <p>ShipperHQ is integrated with all three Winzer eCommerce sites to handle complex shipping rules that are product-based. The system uses variant-level metafields to control shipping restrictions, carrier limitations, and state-specific shipping rules.</p>
        
        <h3>Key Features</h3>
        <ul>
            <li><strong>Product-Based Rules:</strong> Shipping restrictions are applied at the variant level</li>
            <li><strong>State Restrictions:</strong> Products can be restricted from shipping to specific states</li>
            <li><strong>Hazardous Material Handling:</strong> Special rules for hazmat products and carrier limitations</li>
            <li><strong>Size Classifications:</strong> Products categorized by size for shipping method availability</li>
            <li><strong>Dynamic Checkout:</strong> Shipping options update based on cart contents and restrictions</li>
        </ul>

        <div class="alert-box alert-info">
            <strong>Integration Note:</strong> ShipperHQ reads shipping restriction data from Shopify variant metafields and automatically applies rules during the checkout process to determine available shipping options.
        </div>

        <h2 id="shipping-groups-metafield">Shipping Groups Metafield</h2>
        
        <p>The core of the shipping rules system is the <code>global.SHIPPING_GROUPS</code> variant metafield, which contains all shipping restriction identifiers for each product variant.</p>

        <h3>Metafield Configuration</h3>
        
        <table>
            <thead>
                <tr>
                    <th>Property</th>
                    <th>Value</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Field Name</strong></td>
                    <td><code>global.SHIPPING_GROUPS</code></td>
                    <td>Variant-level metafield identifier</td>
                </tr>
                <tr>
                    <td><strong>Data Type</strong></td>
                    <td>String</td>
                    <td>Hash-delimited list of shipping restriction values</td>
                </tr>
                <tr>
                    <td><strong>Scope</strong></td>
                    <td>Variant</td>
                    <td>Applied to individual product variants, not products</td>
                </tr>
                <tr>
                    <td><strong>Required</strong></td>
                    <td>No</td>
                    <td>Only populated for products with shipping restrictions</td>
                </tr>
            </tbody>
        </table>

        <h3>Data Format</h3>
        
        <p>The metafield contains a hash-delimited string of shipping restriction identifiers. ShipperHQ expects the <code>#</code> delimiter to separate different restriction values:</p>
        
        <div class="code-block">
            <code>// Example shipping groups values (hash-delimited format)
"SMALL#CA#NY"                    // Small product restricted from CA and NY
"Hazardous Products#SMALL"       // Hazmat small product
"LARGE#TX#FL"                    // Large product restricted from TX and FL
"MEDIUM"                         // Medium product with no restrictions
""                               // No shipping restrictions

// Real example from SKU J91.4004
"CA#Hazardous Products#MEDIUM"   // Hazmat medium product restricted from CA

// Multiple restrictions example
"Hazardous Products#SMALL#CA#NY#TX"  // Hazmat small product restricted from CA, NY, and TX</code>
        </div>

        <div class="alert-box alert-warning">
            <strong>Critical Format Note:</strong> ShipperHQ requires the hash delimiter (<code>#</code>) to properly parse shipping restriction values. Using commas or other delimiters will cause the restrictions to not be recognized.
        </div>

        <h2 id="shipping-group-values">Shipping Group Values</h2>
        
        <p>The shipping groups system uses several types of identifiers to control shipping behavior:</p>

        <h3>Size Classifications</h3>
        
        <table>
            <thead>
                <tr>
                    <th>Value</th>
                    <th>Description</th>
                    <th>Usage</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>SMALL</code></td>
                    <td>Small package classification</td>
                    <td>Determines available shipping methods and pricing tiers</td>
                </tr>
                <tr>
                    <td><code>MEDIUM</code></td>
                    <td>Medium package classification</td>
                    <td>Standard shipping methods and pricing</td>
                </tr>
                <tr>
                    <td><code>LARGE</code></td>
                    <td>Large package classification</td>
                    <td>Limited shipping methods, may require special handling</td>
                </tr>
            </tbody>
        </table>

        <h3>Hazardous Material Classification</h3>
        
        <table>
            <thead>
                <tr>
                    <th>Value</th>
                    <th>Description</th>
                    <th>Shipping Restrictions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>Hazardous Products</code></td>
                    <td>Products containing hazardous materials</td>
                    <td>Cannot ship via UPS Next Day Air or UPS 2 Day Air</td>
                </tr>
            </tbody>
        </table>

        <h3>State Restrictions</h3>
        
        <p>Products can be restricted from shipping to specific states using state abbreviation codes. When used in the SHIPPING_GROUPS metafield, state codes must be separated by the hash delimiter:</p>
        
        <div class="code-block">
            <code>// Individual state codes (for reference)
"CA"    // California
"NY"    // New York  
"TX"    // Texas
"FL"    // Florida
"IL"    // Illinois
"PA"    // Pennsylvania
// ... all 50 state abbreviations supported

// State restrictions in SHIPPING_GROUPS metafield (hash-delimited)
"CA#NY#TX"                       // Restricted from CA, NY, and TX
"FL#IL"                          // Restricted from FL and IL
"CA"                             // Restricted from CA only
"SMALL#CA#NY"                    // Small product restricted from CA and NY</code>
        </div>

        <h2 id="shipping-rules-logic">Shipping Rules Logic</h2>
        
        <p>ShipperHQ processes the shipping groups data to apply specific shipping rules during checkout:</p>

        <h3>State Restriction Logic</h3>
        
        <div class="code-block">
            <code>// State restriction processing (ShipperHQ parses hash-delimited data)
shipping_groups = product.shipping_groups.split("#")
restricted_states = shipping_groups.filter(group => isStateCode(group))

if (restricted_states.contains(customer_state)) {
    // Remove shipping options for this state
    available_shipping_methods = filter_by_excluded_states(customer_state)
}

// Example: "SMALL#CA#NY" becomes ["SMALL", "CA", "NY"]
// ShipperHQ identifies "CA" and "NY" as state restrictions</code>
        </div>

        <h3>Hazardous Material Logic</h3>
        
        <div class="code-block">
            <code>// Hazardous material processing (ShipperHQ parses hash-delimited data)
shipping_groups = product.shipping_groups.split("#")

if (shipping_groups.contains("Hazardous Products")) {
    // Exclude restricted shipping methods
    available_shipping_methods = exclude_methods([
        "UPS Next Day Air",
        "UPS 2 Day Air"
    ])
}

// Example: "Hazardous Products#SMALL#CA" 
// ShipperHQ identifies "Hazardous Products" and applies hazmat restrictions</code>
        </div>

        <h3>Size Classification Logic</h3>
        
        <div class="code-block">
            <code>// Size-based shipping method filtering (ShipperHQ parses hash-delimited data)
shipping_groups = product.shipping_groups.split("#")
size_classification = shipping_groups.find(group => ["SMALL", "MEDIUM", "LARGE"].contains(group))

switch (size_classification) {
    case "SMALL":
        available_methods = get_small_package_methods()
        break
    case "MEDIUM":
        available_methods = get_standard_methods()
        break
    case "LARGE":
        available_methods = get_large_package_methods()
        break
}

// Example: "LARGE#TX#FL" 
// ShipperHQ identifies "LARGE" and applies large package shipping rules</code>
        </div>

        <h3>Real-World Examples</h3>
        
        <p>Here are practical examples of how the hash-delimited SHIPPING_GROUPS metafield works in different scenarios:</p>
        
        <table>
            <thead>
                <tr>
                    <th>Product Scenario</th>
                    <th>SHIPPING_GROUPS Value</th>
                    <th>Shipping Behavior</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Small hazmat product restricted from CA and NY</td>
                    <td><code>"Hazardous Products#SMALL#CA#NY"</code></td>
                    <td>Cannot ship via UPS Next Day Air or 2 Day Air; cannot ship to CA or NY; uses small package methods</td>
                </tr>
                <tr>
                    <td>Large product with no restrictions</td>
                    <td><code>"LARGE"</code></td>
                    <td>Uses large package shipping methods; no state or carrier restrictions</td>
                </tr>
                <tr>
                    <td>Medium product restricted from multiple states</td>
                    <td><code>"MEDIUM#TX#FL#IL#PA"</code></td>
                    <td>Uses standard shipping methods; cannot ship to TX, FL, IL, or PA</td>
                </tr>
                <tr>
                    <td>Hazmat product with state restrictions</td>
                    <td><code>"Hazardous Products#CA#NY#TX"</code></td>
                    <td>Cannot ship via UPS Next Day Air or 2 Day Air; cannot ship to CA, NY, or TX</td>
                </tr>
                <tr>
                    <td>Small product with single state restriction</td>
                    <td><code>"SMALL#CA"</code></td>
                    <td>Uses small package methods; cannot ship to California only</td>
                </tr>
                <tr>
                    <td><strong>Real Example (SKU J91.4004)</strong></td>
                    <td><code>"CA#Hazardous Products#MEDIUM"</code></td>
                    <td>Hazmat medium product restricted from California; cannot ship via UPS Next Day Air or 2 Day Air</td>
                </tr>
                <tr>
                    <td>Product with no shipping restrictions</td>
                    <td><code>""</code> or empty</td>
                    <td>All standard shipping methods available; no restrictions</td>
                </tr>
            </tbody>
        </table>

        <h2 id="shipperhq-integration">ShipperHQ Integration</h2>
        
        <p>ShipperHQ integrates with Shopify to read shipping restriction data and apply rules during the checkout process:</p>

        <h3>Data Synchronization</h3>
        
        <ul>
            <li><strong>Real-time Updates:</strong> ShipperHQ reads metafield data during checkout</li>
            <li><strong>Cart Evaluation:</strong> All products in cart are evaluated for restrictions</li>
            <li><strong>Dynamic Filtering:</strong> Available shipping methods update based on cart contents</li>
        </ul>

        <h3>Integration Points</h3>
        
        <table>
            <thead>
                <tr>
                    <th>Integration Point</th>
                    <th>Trigger</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Product Page</strong></td>
                    <td>Product added to cart</td>
                    <td>Shipping restrictions noted for checkout</td>
                </tr>
                <tr>
                    <td><strong>Cart Page</strong></td>
                    <td>Cart contents change</td>
                    <td>Shipping options updated based on restrictions</td>
                </tr>
                <tr>
                    <td><strong>Checkout</strong></td>
                    <td>Shipping address entered</td>
                    <td>Final shipping method filtering applied</td>
                </tr>
            </tbody>
        </table>

        <h2 id="customer-experience">Customer Experience</h2>
        
        <p>The shipping rules system provides a seamless experience while ensuring compliance with shipping restrictions:</p>

        <h3>Restriction Communication</h3>
        
        <ul>
            <li><strong>Transparent Messaging:</strong> Customers see clear information about shipping limitations</li>
            <li><strong>Alternative Options:</strong> Available shipping methods are clearly presented</li>
            <li><strong>State-Specific Warnings:</strong> Customers are informed when products cannot ship to their state</li>
        </ul>

        <h3>Checkout Flow</h3>
        
        <ol>
            <li><strong>Cart Review:</strong> Customer reviews products and shipping restrictions</li>
            <li><strong>Address Entry:</strong> Customer enters shipping address</li>
            <li><strong>Method Selection:</strong> Available shipping methods are displayed</li>
            <li><strong>Restriction Handling:</strong> Restricted methods are automatically excluded</li>
            <li><strong>Order Completion:</strong> Order processes with compliant shipping method</li>
        </ol>

        <h2 id="data-flow">Data Flow & Processing</h2>
        
        <p>The shipping restriction data flows through the system as follows:</p>

        <h3>Data Source to Checkout</h3>
        
        <div class="code-block">
            <code>// Data flow for shipping restrictions
Oracle PIM → Middleware → Shopify Metafields → ShipperHQ → Checkout

1. Oracle PIM: Product data with shipping classifications
2. Middleware: Processes and maps shipping data to metafields
3. Shopify: Stores global.SHIPPING_GROUPS metafield data
4. ShipperHQ: Reads metafield data during checkout
5. Checkout: Applies rules and filters shipping options</code>
        </div>

        <h3>Middleware Processing</h3>
        
        <p>The AWS middleware system processes shipping restriction data from Oracle PIM and maps it to the appropriate Shopify metafields:</p>
        
        <ul>
            <li><strong>Data Mapping:</strong> Oracle shipping classifications mapped to SHIPPING_GROUPS values</li>
            <li><strong>State Code Processing:</strong> State restrictions converted to standard abbreviations</li>
            <li><strong>Hazmat Identification:</strong> Hazardous material flags converted to "Hazardous Products"</li>
            <li><strong>Size Classification:</strong> Product dimensions converted to SMALL/MEDIUM/LARGE</li>
        </ul>

        <h2 id="maintenance-troubleshooting">Maintenance & Troubleshooting</h2>
        
        <p>This section covers ongoing maintenance and troubleshooting for the ShipperHQ shipping rules system:</p>

        <h3>Common Issues & Solutions</h3>
        
        <table>
            <thead>
                <tr>
                    <th>Issue</th>
                    <th>Cause</th>
                    <th>Solution</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Shipping restrictions not applying</td>
                    <td>Metafield data not synced or incorrect format</td>
                    <td>Verify global.SHIPPING_GROUPS metafield data and format</td>
                </tr>
                <tr>
                    <td>State restrictions not working</td>
                    <td>Incorrect state abbreviation codes</td>
                    <td>Verify state codes match standard abbreviations (CA, NY, etc.)</td>
                </tr>
                <tr>
                    <td>Hazmat products shipping via restricted methods</td>
                    <td>Missing "Hazardous Products" identifier</td>
                    <td>Add "Hazardous Products" to SHIPPING_GROUPS metafield</td>
                </tr>
                <tr>
                    <td>Size classifications not affecting shipping</td>
                    <td>Missing or incorrect size values</td>
                    <td>Verify SMALL/MEDIUM/LARGE values in metafield</td>
                </tr>
            </tbody>
        </table>

        <h3>Testing Shipping Rules</h3>
        
        <ol>
            <li><strong>Test State Restrictions:</strong> Create test orders with restricted state addresses</li>
            <li><strong>Test Hazmat Products:</strong> Verify hazmat products exclude restricted shipping methods</li>
            <li><strong>Test Size Classifications:</strong> Confirm size-based shipping method availability</li>
            <li><strong>Test Combined Rules:</strong> Test products with multiple restriction types</li>
        </ol>

        <h3>Monitoring & Maintenance</h3>
        
        <ul>
            <li><strong>Regular Audits:</strong> Review shipping restriction data for accuracy</li>
            <li><strong>Rule Updates:</strong> Update restrictions as regulations change</li>
            <li><strong>Performance Monitoring:</strong> Monitor checkout completion rates and shipping issues</li>
            <li><strong>Customer Feedback:</strong> Track customer complaints related to shipping restrictions</li>
        </ul>

        <hr />
        
        <div class="download-section">
            <h3>Download Documentation</h3>
            <p>This documentation is also available in Markdown format for easy editing and version control:</p>
            <a href="winzer-shipperhq-documentation.md" class="download-link" download>Download Markdown Version</a>
        </div>
        
        <div class="contact-section">
            <h3>Questions or Issues?</h3>
            <p>For technical questions about this ShipperHQ implementation, contact:</p>
            <p><strong>Arcadia Digital</strong><br />
            <a href="mailto:pete.buzzell@arcadiadigital.com">pete.buzzell@arcadiadigital.com</a></p>
            
            <h3>Additional Resources</h3>
            <p>For general ShipperHQ questions and documentation:</p>
            <ul>
                <li><strong>ShipperHQ Documentation:</strong> <a href="https://help.shipperhq.com/" target="_blank">https://help.shipperhq.com/</a></li>
                <li><strong>ShipperHQ API Reference:</strong> <a href="https://docs.shipperhq.com/" target="_blank">https://docs.shipperhq.com/</a></li>
            </ul>
        </div>
        </div>
    </div>
    
    <!-- Include Footer Component -->
    <div id="footer-container"></div>
    
    <script>
        // Load footer component
        fetch('footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-container').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading footer:', error);
                // Fallback footer if component fails to load
                document.getElementById('footer-container').innerHTML = `
                    <footer class="arcadia-footer">
                        <div class="footer-content">
                            <p>This documentation is proprietary and confidential. Unauthorized distribution is prohibited.</p>
                            <p><a href="https://arcadiadigital.com" target="_blank">Arcadia Digital</a> | <a href="https://github.com/petebuzzell-ad/winzer-documentation" target="_blank">GitHub Repository</a></p>
                        </div>
                    </footer>
                `;
            });
    </script>
</body>
</html>
