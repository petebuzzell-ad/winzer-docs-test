{{ 'section-shop-the-look.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{% assign sectionId = '.feature-diagram--' | append: section.id %}
{{ 'swiper-carousel-custom.css' | asset_url | stylesheet_tag }}

{% capture margin_size %}
  {% if section.settings.display_margins %}
    {{ settings.margin_size }}
  {% else %}
    0
  {% endif %}
{% endcapture %}

{% capture mobile_margin_size %}
  {% if section.settings.display_margins %}
    {{ settings.mobile_margin_size }}
  {% else %}
    0
  {% endif %}
{% endcapture %}

{% style %}
  #shopify-section-{{ section.id }} {
    margin-top: {{ margin_size | divided_by: 10 }}rem;
    margin-bottom: {{ margin_size | divided_by: 10 }}rem;
  }

  @media screen and (max-width: 750px) {
    #shopify-section-{{ section.id }} {
      margin-top: {{ mobile_margin_size | divided_by: 10 }}rem;
      margin-bottom: {{ mobile_margin_size | divided_by: 10 }}rem;
    }
  }
{% endstyle %}

<div class="feature-diagram__outer-wrapper feature-diagram--{{ section.id }} page-width page-width-desktop {% if settings.scroll_appear == "fadein" %} fadeIn {% endif %}" style="background-color: {{ section.settings.diagram__background_color }};">
  <div class="feature-diagram__inner-wrapper" id="{{ section.id }}">
    <div class="feature-diagram__body">
      <div class="feature-diagram__body-inner-wrapper">
        <div class="feature-diagram__text-content-mobile large-up-hide">
          <h5 class="feature__eyebrow eyebrow">{{ section.settings.eyebrow }}</h5>
          <h4 class="feature__heading {{ section.settings.headline_size }}" style="color: {{ section.settings.diagram__heading_color }};">{{ section.settings.heading }}</h4>
          <div class="feature__caption">
            <span class="feature__caption-text-1 {% if section.settings.text_style == "caption-script" %} caption{% else %} {{ section.settings.text_style }}{% endif %}" > {{ section.settings.caption }}</span>
            <span class="feature__caption-text-2 {{ section.settings.text_style }}"> {{ section.settings.caption_2 }}</span>
          </div>
        </div>
        <div class="feature-diagram__main-image-wrapper">
          {% render 'image', image: section.settings.diagram__image, class: 'feature-diagram__image' %}
          <div class="feature-diagram__feature-selectors small-hide medium-hide"  style="padding-top: {{ 1 | divided_by: section.settings.diagram__image.aspect_ratio | times: 100 }}%;">
            {% for block in section.blocks %}
              {% case block.type %}
                {% when "feature_carousel" %}
                {% assign slide_number = forloop.index0 | plus: 1 %}
                  <button
                    class="feature-diagram__feature-selector {% if forloop.index0 == 0 %}selected{% endif %}"
                    data-feature-id="{{ block.id }}"
                    data-feature-key="{{ forloop.index0 }}"
                    aria-label="Feature {{ slide_number}}: {{ block.settings.heading }}. {{ block.settings.description }}"
                  >{{ slide_number }}</button>
                {% else %}
              {% endcase %}
            {% endfor %}
          </div>
        </div>
      </div>

      <div class="feature-diagram__feature-slider-wrapper" style="background-color: {{ section.settings.diagram__background_color }};">
        <div class="feature-diagram__text-content small-hide medium-hide">
          <h5 class="feature__eyebrow eyebrow">{{ section.settings.eyebrow }}</h5>
          <h4 class="feature__heading {{ section.settings.headline_size }}" style="color: {{ section.settings.diagram__heading_color }};">{{ section.settings.heading }}</h4>
          <div class="feature__caption">
            <span class="feature__caption-text-1 {% if section.settings.text_style == "caption-script" %} caption{% else %} {{ section.settings.text_style }}{% endif %}" > {{ section.settings.caption }}</span>
            <span class="feature__caption-text-2 {{ section.settings.text_style }}"> {{ section.settings.caption_2 }}</span>
          </div>
        </div>
        <feature-slider class="feature-diagram__feature-slider" data-section-id="{{ section.id }}">
          <div class="swiper mySwiper">
            <div class="swiper-wrapper">
              {% for block in section.blocks %}
                {% case block.type %}
                  {% when "feature_carousel" %}
                    <div class="feature-diagram__feature-body feature swiper-slide" {{ block.shopify_attributes }} id="block-{{ block.id }}" data-index="{{ forloop.index0 }}">
                      <div class="feature__inner-wrapper">
                        <div class="feature__body-wrapper">
                          <a class="small-hide medium-hide" href="{{ block.settings.feature_product.url }}">
                            {% render 'image', image: block.settings.feature_product.featured_image, image_max_width: 300, image_desired_width: block.settings.inline_width_desktop, class: 'feature__product-image' %}
                          </a>
                          <a class="large-up-hide" href="{{ block.settings.feature_product.url }}">
                            {% render 'image', image: block.settings.feature_product.featured_image, image_max_width: 200, image_desired_width: block.settings.inline_width_mobile, %}
                          </a>
                          <div class="feature__product-info">
                            <div class="feature__product-title eyebrow">{{ block.settings.feature_product.title }}</div>
                            {% render 'price', product: block.settings.feature_product, price_class: '' %}
                          </div>
                          {% if block.settings.show_cta %}
                            <div class="feature__product-cta small-hide medium-hide">
                              {% render 'button' label: 'SHOP THE PRODUCT', variation: 'primary', size: 'large', shape: 'round', class: 'hover', link: block.settings.feature_product.url %}
                            </div>
                          {% endif %}       
                        </div>
                        {% if block.settings.show_cta %}
                          <div class="feature__product-cta large-up-hide">
                            {% render 'button' label: 'SHOP THE PRODUCT', variation: 'primary', size: 'large', shape: 'round', class: 'hover', link: block.settings.feature_product.url   %}
                          </div>
                        {% endif %}
                      </div>
                    </div>
                  {% else %}
                {% endcase %}
              {% endfor %}
            </div>
          </div>
          <div class="shop-the-look carousel-button-prev">
            <svg class="icon icon-filter-arrow-up" viewBox="0 0 16 9" version="1.1" xmlns="http://www.w3.org/2000/svg">
              <g id="PLP-&amp;-Search-(Batch-2)" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                  <g id="PLP-Filters-Open" transform="translate(-1325.000000, -754.000000)" fill="#444444" fill-rule="nonzero">
                      <path d="M1329.17623,751.169473 C1329.28876,751.060976 1329.44157,751 1329.60092,751 C1329.76027,751 1329.91307,751.060976 1330.02561,751.169473 L1337.22377,758.091738 C1337.33659,758.199961 1337.4,758.346907 1337.4,758.500151 C1337.4,758.653395 1337.33659,758.800342 1337.22377,758.908565 L1330.02561,765.83083 C1329.79106,766.05639 1329.41078,766.05639 1329.17623,765.83083 C1328.94168,765.605269 1328.94168,765.239563 1329.17623,765.014002 L1335.9509,758.500151 L1329.17623,751.9863 C1329.06341,751.878077 1329,751.731131 1329,751.577887 C1329,751.424642 1329.06341,751.277696 1329.17623,751.169473 Z" id="Path-Copy-2" transform="translate(1333.200000, 758.500000) scale(1, -1) rotate(90.000000) translate(-1333.200000, -758.500000) "></path>
                  </g>
              </g>
            </svg>
          </div>
          <div class="shop-the-look carousel-button-next">
            <svg class="icon icon-filter-arrow-up" viewBox="0 0 16 9" version="1.1" xmlns="http://www.w3.org/2000/svg">
              <g id="PLP-&amp;-Search-(Batch-2)" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                  <g id="PLP-Filters-Open" transform="translate(-1325.000000, -754.000000)" fill="#444444" fill-rule="nonzero">
                      <path d="M1329.17623,751.169473 C1329.28876,751.060976 1329.44157,751 1329.60092,751 C1329.76027,751 1329.91307,751.060976 1330.02561,751.169473 L1337.22377,758.091738 C1337.33659,758.199961 1337.4,758.346907 1337.4,758.500151 C1337.4,758.653395 1337.33659,758.800342 1337.22377,758.908565 L1330.02561,765.83083 C1329.79106,766.05639 1329.41078,766.05639 1329.17623,765.83083 C1328.94168,765.605269 1328.94168,765.239563 1329.17623,765.014002 L1335.9509,758.500151 L1329.17623,751.9863 C1329.06341,751.878077 1329,751.731131 1329,751.577887 C1329,751.424642 1329.06341,751.277696 1329.17623,751.169473 Z" id="Path-Copy-2" transform="translate(1333.200000, 758.500000) scale(1, -1) rotate(90.000000) translate(-1333.200000, -758.500000) "></path>
                  </g>
              </g>
            </svg>
          </div>
        </feature-slider>
      </div>
    </div>
  </div>
</div>

{% style %}
  {%- for block in section.blocks -%}
    {%- case block.type -%}
      {%- when "feature_carousel" -%}
        {{ sectionId }} .feature-diagram__feature-selector[data-feature-id="{{ block.id }}"] {
          left: {{ block.settings.h_pos }}%;
          top: {{ block.settings.v_pos }}%;
        }

        {{ sectionId }} .feature-diagram__feature-selector, {{ sectionId }} .feature-diagram__feature-selector.selected {
          border: 0.15rem solid {{ section.settings.diagram__selectors_text_color }};
          background-color: {{ section.settings.diagram__selectors_color }};
          color: {{ section.settings.diagram__selectors_text_color }};
        }
    {%- endcase -%}
  {%- endfor -%}

  {% if section.settings.diagram__text_color %}
    {{ sectionId }} .feature__caption-text-1,
    {{ sectionId }} .feature__caption-text-2,
    {{ sectionId }} .feature__product-title,
    {{ sectionId }} .price,
    {{ sectionId }} .feature__eyebrow {
      color: {{ section.settings.diagram__text_color }};
    }
  {% endif %}

  {% if section.settings.diagram__heading_color %}
    {{ sectionId }} .featured__diagram_heading  {
      color: {{ section.settings.diagram__heading_color }};
    }
  {% endif %}

  {% if section.settings.diagram__background_color %}
    {{ sectionId }} .featured__diagram {
      background-color: {{ section.settings.diagram__background_color }};
    }
  {% endif %}

  {% if section.settings.background_image != blank %}
    {{ sectionId }} {
      background-image: url({{ section.settings.background_image | img_url: 'master' }});
    }
  {% endif %}

  @media screen and (min-width:990px) {
    {% if section.settings.display_image_right %}
    {{ sectionId }} .feature-diagram__body {
      flex-direction: row-reverse;
    }
    {% endif %}
  }

  @media screen and (max-width: 749px) {
    .feature-diagram--{{ section.id }} {
      padding-top: {{ section.settings.mobile_top_padding }}px;
      padding-bottom: {{ section.settings.mobile_bottom_padding }}px;
    }
  }

  @media screen and (min-width: 750px) {
    .feature-diagram--{{ section.id }} {
      padding-top: {{ section.settings.desktop_top_padding }}px;
      padding-bottom: {{ section.settings.desktop_bottom_padding }}px;
    }
  }

{% endstyle %}

{% javascript %}
  class FeatureSlider extends HTMLElement {
    constructor() {
      super();

      window.addEventListener('load', this.initCarousel.bind(this));

      this.contentWrapper = this.closest(".feature-diagram__inner-wrapper");
      this.featureButtons =  this.contentWrapper.querySelectorAll('.feature-diagram__feature-selector');
      this.sectionId = this.dataset.sectionId;

      if (Shopify.designMode) {
        document.addEventListener('shopify:section:load', this.initCarousel.bind(this));
        document.addEventListener('shopify:block:select', (event) => {
          const { blockId, sectionId } = event.detail;

          if (this.dataset.sectionId === sectionId) {
            const block = this.querySelector(`#block-${blockId}`);

            if (block) {
              const index = block.dataset.index;

              if (index) {
                this.flkty.select(parseInt(index));
              }
            }
          }
        })
      }
    }

    initCarousel() {
      this.swiper = new Swiper(".feature-diagram__feature-slider .mySwiper", {
        slidesPerView: 1,
        loop: true,
        navigation: {
          nextEl: ".shop-the-look.carousel-button-next",
          prevEl: ".shop-the-look.carousel-button-prev",
        }
      });
    }
  }

  customElements.define('feature-slider', FeatureSlider);
{% endjavascript %}

{% schema %}
{
  "name": "Shop The Look",
  "tag": "section",
  "max_blocks": 6,
  "class": "section section-featured-diagram",
  "settings": [
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background Image"
    },
    {
      "type": "image_picker",
      "id": "diagram__image",
      "label": "Feature Image"
    },
    {
      "type": "checkbox",
      "id": "display_image_right",
      "label": "Display image on right?",
      "default": false,
      "info": "If checked Feature Image would be displayed in the right column on desktop sizes!"
    },
    {
      "type": "header",
      "content": "Text content"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow",
      "default": "Eyebrow"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop The Look"
    },
    {
      "type": "select",
      "id": "headline_size",
      "options": [
        {
          "value": "cql-headline-1",
          "label": "Custom Headline 1"
        },
        {
          "value": "cql-headline-2",
          "label": "Custom Headline 2"
        },
        {
          "value": "cql-headline-3",
          "label": "Custom Headline 3"
        },
        {
          "value": "h4",
          "label": "X-Small"
        },
        {
          "value": "h3",
          "label": "Small"
        },
        {
          "value": "h2",
          "label": "Medium"
        },
        {
          "value": "h1",
          "label": "Large"
        },
        {
          "value": "h0",
          "label": "X-Large"
        }
      ],
      "default": "h1",
      "label": "Headline size"
    },
    {
      "type": "text",
      "id": "caption",
      "label": "Caption text 1",
      "default": "Designed By"
    },
    {
      "type": "text",
      "id": "caption_2",
      "label": "Caption text 2",
      "default": "Designer Name"
    },
    {
      "type": "select",
      "id": "text_style",
      "options": [
        {
          "value": "caption-script",
          "label": "Caption with Script"
        },
        {
          "value": "subtitle",
          "label": "Subtitle"
        },
        {
          "value": "caption",
          "label": "Caption"
        },
        {
          "value": "caption-with-letter-spacing",
          "label": "Uppercase"
        },
        {
          "value": "caption-with-letter-spacing--medium",
          "label": "Uppercase - Medium"
        },
        {
          "value": "caption-with-letter-spacing--large",
          "label": "Uppercase - Large"
        }
      ],
      "default": "caption",
      "label": "Caption text style"
    },
    {
      "type": "header",
      "content": "Section colors"
    },
    {
      "type": "color",
      "id": "diagram__background_color",
      "label": "Background color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "diagram__heading_color",
      "label": "Heading color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "diagram__text_color",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "diagram__selectors_color",
      "label": "Selector dots color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "diagram__selectors_text_color",
      "label": "Selector dots text color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "number",
      "id": "desktop_top_padding",
      "label": "Top padding - Desktop (px)",
      "default": 60
    },
    {
      "type": "number",
      "id": "desktop_bottom_padding",
      "label": "Bottom padding - Desktop (px)",
      "default": 60
    },
    {
      "type": "number",
      "id": "mobile_top_padding",
      "label": "Top padding - Mobile (px)",
      "default": 45
    },
    {
      "type": "number",
      "id": "mobile_bottom_padding",
      "label": "Bottom padding - Mobile (px)",
      "default": 45
    },
    {
      "type": "header",
      "content": "Margins",
      "info": "Apply global theme layout margins on the top and bottom"
    },
    {
      "type": "checkbox",
      "id": "display_margins",
      "label": "Display margins",
      "default": false
    }
  ],
  "blocks": [
    {
      "name": "Product",
      "type": "feature_carousel",
      "limit": 5,
      "settings": [
        {
          "type": "header",
          "content": "Carousel Product"
        },
        {
          "type": "product",
          "id": "feature_product",
          "label": "Product"
        },
        {
          "type": "checkbox",
          "id": "show_cta",
          "label": "Show Shop Product CTA",
          "default": true
        },
        {
          "type": "number",
          "id": "inline_width_desktop",
          "label": "Image width (desktop)",
          "default": 160,
          "info": "If left blank, will use the native width of the image, up to 300px."
        },
        {
          "type": "number",
          "id": "inline_width_mobile",
          "label": "Image width (mobile)",
          "default": 160,
          "info": "If left blank, will use the native width of the image, up to 300px."
        },
        {
          "type": "header",
          "content": "Feature dot"
        },
        {
          "type": "range",
          "id": "v_pos",
          "label": "Dot vertical position",
          "min": 5,
          "max": 95,
          "step": 1,
          "default": 5
        },
        {
          "type": "range",
          "id": "h_pos",
          "label": "Dot horizontal position",
          "min": 5,
          "max": 95,
          "step": 1,
          "default": 5
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Shop The Look"
    }
  ]
}
{% endschema %}